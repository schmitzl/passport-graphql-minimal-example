{"version":3,"file":"bundle.umd.js","sources":["utils.js","index.js"],"sourcesContent":["import { checkDocument, removeDirectivesFromDocument, } from 'apollo-utilities';\nvar connectionRemoveConfig = {\n    test: function (directive) { return directive.name.value === 'client'; },\n    remove: true,\n};\nvar removed = new Map();\nexport function removeClientSetsFromDocument(query) {\n    var cached = removed.get(query);\n    if (cached)\n        return cached;\n    checkDocument(query);\n    var docClone = removeDirectivesFromDocument([connectionRemoveConfig], query);\n    removed.set(query, docClone);\n    return docClone;\n}\n//# sourceMappingURL=utils.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { ApolloLink, Observable, } from 'apollo-link';\nimport { hasDirectives, getMainDefinition } from 'apollo-utilities';\nimport { graphql } from 'graphql-anywhere/lib/async';\nimport { removeClientSetsFromDocument } from './utils';\nvar capitalizeFirstLetter = function (str) { return str.charAt(0).toUpperCase() + str.slice(1); };\nexport var withClientState = function (clientStateConfig) {\n    if (clientStateConfig === void 0) { clientStateConfig = { resolvers: {} }; }\n    var resolvers = clientStateConfig.resolvers, defaults = clientStateConfig.defaults, cache = clientStateConfig.cache, typeDefs = clientStateConfig.typeDefs;\n    if (cache && defaults) {\n        cache.writeData({ data: defaults });\n    }\n    var addedSchemaToContext = false;\n    return new (function (_super) {\n        __extends(StateLink, _super);\n        function StateLink() {\n            return _super !== null && _super.apply(this, arguments) || this;\n        }\n        StateLink.prototype.writeDefaults = function () {\n            if (cache && defaults) {\n                cache.writeData({ data: defaults });\n            }\n        };\n        StateLink.prototype.request = function (operation, forward) {\n            if (typeDefs && !addedSchemaToContext) {\n                var directives_1 = 'directive @client on FIELD';\n                var definition_1 = typeof typeDefs === 'string'\n                    ? typeDefs\n                    : typeDefs.map(function (typeDef) { return typeDef.trim(); }).join('\\n');\n                operation.setContext(function (_a) {\n                    var _b = _a.schemas, schemas = _b === void 0 ? [] : _b;\n                    return ({\n                        schemas: schemas.concat([{ definition: definition_1, directives: directives_1 }]),\n                    });\n                });\n                addedSchemaToContext = true;\n            }\n            var isClient = hasDirectives(['client'], operation.query);\n            if (!isClient)\n                return forward(operation);\n            var server = removeClientSetsFromDocument(operation.query);\n            var query = operation.query;\n            var type = capitalizeFirstLetter((getMainDefinition(query) || {}).operation) || 'Query';\n            var resolver = function (fieldName, rootValue, args, context, info) {\n                if (rootValue === void 0) { rootValue = {}; }\n                var fieldValue = rootValue[fieldName];\n                if (fieldValue !== undefined)\n                    return fieldValue;\n                var resolverMap = resolvers[rootValue.__typename || type];\n                var resolve = resolverMap[fieldName];\n                if (resolve)\n                    return resolve(rootValue, args, context, info);\n            };\n            return new Observable(function (observer) {\n                if (server)\n                    operation.query = server;\n                var obs = server && forward\n                    ? forward(operation)\n                    : Observable.of({\n                        data: {},\n                    });\n                var observerErrorHandler = observer.error.bind(observer);\n                var sub = obs.subscribe({\n                    next: function (_a) {\n                        var data = _a.data, errors = _a.errors;\n                        var context = operation.getContext();\n                        graphql(resolver, query, data, context, operation.variables)\n                            .then(function (nextData) {\n                            observer.next({\n                                data: nextData,\n                                errors: errors,\n                            });\n                            observer.complete();\n                        })\n                            .catch(observerErrorHandler);\n                    },\n                    error: observerErrorHandler,\n                });\n                return function () {\n                    if (sub)\n                        sub.unsubscribe();\n                };\n            });\n        };\n        return StateLink;\n    }(ApolloLink))();\n};\n//# sourceMappingURL=index.js.map"],"names":["checkDocument","removeDirectivesFromDocument","this","hasDirectives","getMainDefinition","Observable","graphql","ApolloLink"],"mappings":"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"}